<main class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden relative z-10">
  <div class="p-6 sm:p-10">
    <div class="text-center mb-8">
      <img src="https://images.pexels.com/photos/3764984/pexels-photo-3764984.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1" alt="Auto del sorteo" class="w-full h-auto rounded-lg shadow-md object-cover">
      <h1 class="font-christmas text-4xl sm:text-5xl text-red-600 mt-4">¡Completa tu Registro!</h1>
      <p class="text-gray-600 mt-2 text-lg">Llena tus datos para participar en el sorteo.</p>
    </div>
    
    <form [formGroup]="raffleForm" (ngSubmit)="submitForm()">
      <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700">Foto de la Cédula</label>
        @if(idPhotoPreview()){
          <img [src]="idPhotoPreview()" alt="Vista previa de la cédula" class="mt-2 rounded-md max-h-48 w-auto mx-auto border"/>
        }
        <p class="text-center text-xs mt-2 text-gray-500">
          Foto capturada en el paso anterior. 
          <a routerLink="/camera-scan" class="text-red-600 underline">Tomar de nuevo</a>.
        </p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-5">
        <div>
          <label for="doc-type" class="block text-sm font-medium text-gray-700">Tipo de Documento</label>
          <select id="doc-type" formControlName="tipoDocumentoIdentidad" class="input-style">
              <option value="V">Venezolana</option>
              <option value="E">Extranjero</option>
          </select>
        </div>
        <div>
          <label for="doc-number" class="block text-sm font-medium text-gray-700">Nº de Documento</label>
          <input type="text" id="doc-number" formControlName="numeroDocumento" class="input-style">
        </div>

        <div>
          <label for="first-name" class="block text-sm font-medium text-gray-700">Primer Nombre</label>
          <input type="text" id="first-name" formControlName="primerNombre" class="input-style">
        </div>
        <div>
          <label for="second-name" class="block text-sm font-medium text-gray-700">Segundo Nombre <span class="text-gray-500">(Opcional)</span></label>
          <input type="text" id="second-name" formControlName="segundoNombre" class="input-style">
        </div>
        <div>
          <label for="last-name" class="block text-sm font-medium text-gray-700">Primer Apellido</label>
          <input type="text" id="last-name" formControlName="primerApellido" class="input-style">
        </div>
        <div>
          <label for="second-last-name" class="block text-sm font-medium text-gray-700">Segundo Apellido <span class="text-gray-500">(Opcional)</span></label>
          <input type="text" id="second-last-name" formControlName="segundoApellido" class="input-style">
        </div>

        <div class="md:col-span-2">
          <label for="email" class="block text-sm font-medium text-gray-700">Correo Electrónico</label>
          <input type="email" id="email" formControlName="email" class="mt-1 block w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md shadow-sm sm:text-sm" readonly>
        </div>
      

        <div>
          <label for="state" class="block text-sm font-medium text-gray-700">Estado</label>
          <select id="state" formControlName="estado" (change)="onStateChange($event)" class="input-style">
            <option [ngValue]="null" disabled>Selecciona un estado</option>
            @for(state of allStates(); track state.id) {
              <option [value]="state.id">{{ state.nombre }}</option>
            }
          </select>
        </div>
        <div>
          <label for="ciudad" class="block text-sm font-medium text-gray-700">Parroquia/Sector</label>
          <select id="ciudad" formControlName="ciudad" class="input-style">
            <option [ngValue]="null" disabled>Selecciona una ciudad</option>
             @for(city of citiesOfSelectedState(); track city.id) {
              <option [value]="city.id">{{ city.Nombre }}</option>
            }
          </select>
        </div>

        <div class="md:col-span-2">
            <label for="address" class="block text-sm font-medium text-gray-700">Dirección</label>
            <input type="text" id="address" formControlName="direccion" class="input-style">
        </div>

        <div class="md:col-span-2">
          <label for="phone" class="block text-sm font-medium text-gray-700">Teléfono</label>
          <div class="flex space-x-2 mt-1">
            <select formControlName="phoneCode" class="input-style w-1/3">
              <option value="" disabled>Código</option>
              @for(code of phoneCodes; track code){
                <option [value]="code">{{ code }}</option>
              }
            </select>
            <input type="text" formControlName="phoneNumber" class="input-style w-2/3" placeholder="Ejemplo: 1234567">
          </div>
          <p class="text-xs text-gray-500 mt-1">Ingresa tu número de teléfono con código de área.</p>
        </div>

      </div>
      
      <div class="mt-6">
        <div class="flex items-center">
          <input id="terminos" type="checkbox" formControlName="terminos" class="h-4 w-4 text-red-600 border-gray-300 rounded focus:ring-red-500">
          <label for="terminos" class="ml-2 block text-sm text-gray-900">
            Acepto los <a href="javascript:void(0)" (click)="openModal()" class="text-red-600 underline">términos y condiciones</a>.
          </label>
        </div>
      </div>

      <div class="mt-8">
        <button type="submit" [disabled]="raffleForm.invalid || loading" class="w-full flex justify-center items-center py-3 px-4 rounded-lg shadow-lg text-lg font-bold text-white bg-green-600 hover:bg-green-700 disabled:bg-gray-400 christmas-button-animation">
          Finalizar Registro y Participar
        </button>
      </div>
    </form>
  </div>
</main>

<!-- Modal -->
<div *ngIf="isModalVisible" class="fixed z-50 inset-0 overflow-y-auto">
  <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
    <div class="fixed inset-0 transition-opacity" aria-hidden="true">
      <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
    </div>
    <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
    <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
      <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
        <div class="sm:flex sm:items-start">
          <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
            <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">
              Términos y Condiciones
            </h3>
            <div class="mt-2">
              <p class="text-sm text-gray-500">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
              </p>
            </div>
          </div>
        </div>
      </div>
      <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
        <button (click)="closeModal()" type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm">
          Cerrar
        </button>
      </div>
    </div>
  </div>
</div>
